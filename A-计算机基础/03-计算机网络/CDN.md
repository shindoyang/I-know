# CDN



CDN网络是在用户和服务器之间增加Cache层，如何将用户的请求引导到Cache上获得源服务器的数据，主要是通过接管DNS实现，这就是CDN的最基本的原理。

CDN最大的难点

## 原理

1.用户向浏览器输入www.mashibing.com这个域名，浏览器第一次发现本地没有dns缓存，需要获取域名的ip地址

- 查找本机host文件
- 查找本机dns缓存
- 向网络连接中设置的dns服务器发送请求
- 把ip缓存到本机

2.www.mashibing.com这个域名配置智能dns解析

3.CDN网络中的智能DNS系统解析域名，起到负载均衡和高可用的作用，返回给用户合理的ip，可用的->附近的->响应最快的->负载低的

4.用户向该IP节点（CDN服务器）发出请求；

5.由于是第一次访问，CDN服务器会向原web站点请求，并缓存内容；

- 内容提交
- ttl超时
- cdn服务器向源服务器获取资源

6.请求结果发给用户。

每个CDN节点由两部分组成

- 负载均衡设备
- 高速缓存服务器

其实就是一个负载均衡器 lvs或 nginx，配合keepalived做到入口高可用，代理或转发请求到内网节点，做负载均衡

## 应用场景

适用
1. css、js、img 等 html骨架中包含的静态资源
2. app 内需要的img、html等资源
2. 音视频点播资源
3. 大文件下载

不适用
1. 私密商业数据，
2. 包含有逻辑的请求
3. 需要鉴权
4. 长连接 
5. reactor模型
6. 即时通讯