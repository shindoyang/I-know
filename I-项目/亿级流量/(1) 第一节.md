### 多级缓存



对于提问的高并发问题，需要先明确：

1. 针对多大的流量 QPS
2. 数据一致性要求：
   1. 高，强一致性，性能消耗较高
   2. 底，弱一致性，最终一致性



其实高并发，归根到底就是要削峰---> 解决手段：集群

打通集群的前置角色：nginx （官方声称在物理硬件优化的前提下，单台nginx的最高并发处理能力能达到5W）

> 请求最终是要服务层消化的，一般是Tomcat容器，其理论并发值低于200 （QPS）



方案

1、划分域名

通过不同的域名来分离出一套套的业务线，每套业务线对应一组服务器

2、CDN

如果单一域名也抗不住了，加CDN缓存

CDN：缓存静态资源（js、css、图片等）/一致型要求低的动态资源（如电商的列表页、搜索结果页）

CDN除了一个坏处，其他都是好处。缺点就是缓存刷新，可以通过JOB（定时任务来定时刷新缓存）

3、LVS

基于四层的负载均衡，其实不能算是真正意义上的四层，因为LVS不会真正握手，他只是窥探了第四层里面的目标地址，然后转发。

4、接入层：Nginx    这一层就可以引入Redis缓存集群

基于七层的反向代理 和 负载均衡

nginx不能编程，但有如下两种方式增强nginx

* 用户C语言开发nginx模块

* 用lua语言 在nginx中内嵌逻辑

  （nginx + lua  + redis 实现缓存读写   /   nginx + lua  +  kafka 实现消息下推（可做限流））

5、业务层：高可用







